---
layout: post
title: Linux 文本操作
categories: [Linux]
description: 
keywords: Linux 文本操作.md
mermaid: false
sequence: false
flow: false
mathjax: false
mindmap: false
mindmap2: false
---
# Text_Manage

> 文本的复制与粘贴

- 命令模式下的文本复制（复制+粘贴）
    - yw：将光标所在位置到字尾的字符复制到缓冲区。
    - nyw：将从光标所在位置开始的n个字复制到缓冲区。
    - yy：将光标所在的行复制到缓冲区。
    - nyy：将光标所在的行开始连续n行复制到缓冲区。
    - p：将缓冲区的字符粘贴到光标所在位置。
- 末行模式下的文本复制
- $：行x，行y co 行z$
    - 即将文本x-y行的内容，复制到z行下。例如：
        - **：1, 4 co 5**
        - 当前编辑的文件1-4行复制到5行下，即原来文件内容新增了4行。
- 寄存器操作
    - 自定义寄存器
        - 从当前光标复制n行到指定寄存器a下：命令模式下：输入["anyy]



## 文本查看

### 相关命令

#### cat

查看文件内容，语法：`cat [选项] [文件]`



- cat -b：对非空输出行编号
- cat -n：对输出的所有行编号
- cat -s：不输出多行空行
- cat -v：查看特殊字符
- cat > 文件名称: 创建并打开一个新的文件。



#### tac

是 cat 的反向操作，从最后一行开始打印。



#### diff

比较两个文件



#### more

和cat类似，一般用于查看日志，内容比较长的文件。more会先显示一部分内容，按回车就可以继续读取内容，按q退出，但more有一个弊端，只能往下翻，不能往上翻。

和 cat 不同的是它可以一页一页查看文件内容，比较适合大文件的查看。

- more -n：
- q：



#### less

查看文件内容，less用法比more更具有弹性，可以使用 `[pageup][pagedown] `（前后按键）等按键的功能来往前往后翻看文件，而且less在查看之前不会加载整个文件。

和 more 类似，但是多了一个向前翻页的功能。



- less -i：忽略大小写
- less -N：显示行号
- /字符串：向上搜索字符串的内容
- ?字符串：向下搜索字符串的内容
- n ：重复前一个搜索（与/ 或?有关）
- N：返向重复前一个搜索（与/ 或?有关）
- q：退出less



#### head

显示文件内容的开头到标准输出，也就是屏幕上，head不加参数默认显示前10行。取得文件前几行。

```
## head [-n number] filename
-n : 后面接数字，代表显示几行的意思
```



- hean -n <行数>：指定显示的行数，n可以省略。



#### tail

用于显示指定文件末尾内容，一般用于查看日志。是 head 的反向操作，只是取得是后几行。



- tail -f ：循环读取
- tail -n<行号>：显示行数



##### 管道操作

```bash
# 显示第100行到110行
$ head -110 cat.txt | tail -10 
```



#### grep

文本行过滤，搜索字符串。grep指令也支持正则表达式。



- grep -i：忽略大小写，大小写视为相同
- grep -n：输出行号
- grep -v：反向选择，查找不包含指定内容的



#### sed

- sed -i：去除特殊字符



### 常用命令

```bash
# 查看有几个逻辑cpu, 包括cpu型号
cat /proc/cpuinfo | grep name | cut -f2 -d: | uniq -c

# 查看有几颗cpu,每颗分别是几核
cat /proc/cpuinfo | grep physical | uniq -c

# 查看系统内核版本
cat /proc/version

# 结果大于0, 说明支持64bit计算. lm指long mode, 支持lm则是64bit
cat /proc/cpuinfo | grep flags | grep ' lm ' | wc -l
```



```bash
# 反向匹配, 查找不包含xxx的内容
grep -v xxx

# 排除所有空行
grep -v '^/pre>

# 返回结果 2,则说明第二行是空行
grep -n “^$” 111.txt    

# 查询以abc开头的行
grep -n “^abc” 111.txt 

# 同时列出该词语出现在文章的第几行
grep 'xxx' -n xxx.log

# 计算一下该字串出现的次数
grep 'xxx' -c xxx.log

# 比对的时候，不计较大小写的不同
grep 'xxx' -i xxx.log
```



## 文本编辑

### 相关命令

#### echo

将字符串显示到标准输出，也就是屏幕上，echo默认换行。通过重定向，字符串后面加 > 符号和文件名，就可以将本该显示到标准输出的字符串，写入文件中，如果文件不存在，就会自动创建文件。

输出重定向会清空文件原始内容再重新写入，想要保留之前的内容并写入就需要追加重定向 > 符号变成 >> 符号。



写一个内容从0-1000行的文件：

```
count=0; while [ $count -le 1000 ]; do echo "hello ${count}"; let count++; done > cat.txt
```


# VIM

## Introduction

vi 命令是 UNIX 操作系统和类 UNIX 操作系统中最通用的全屏幕纯文本编辑器。

Linux 中的 vi 编辑器叫 vim，它是 vi 的增强版（vi Improved），与 vi 编辑器完全兼容，而且实现了很多增强功能。



## VIM Mode

vi 编辑器支持编辑模式和命令模式，编辑模式下可以完成文本的编辑功能，命令模式下可以完成对文件的操作命令，要正确使用 vi 编辑器就必须熟练掌握着两种模式的切换。

- 一般指令模式(Command mode): VIM 的默认模式，可以用于移动游标查看内容；

- 编辑模式(Insert mode): 按下 "i" 等按键之后进入，可以对文本进行编辑；

- 指令列模式(Bottom-line mode): 按下 ":" 按键之后进入，用于保存退出等操作。



![img](https://oss.xubighead.top/oss/image/202506/1930505570063847426.jpg)



### Command Mode

当用户使用 vi 命令打开文件后，则进入命令模式，用户可以输入命令来执行各种功能。

| Value     | Description            |
| --------- | ---------------------- |
| L         | 光标移动至屏幕最后一行 |
| space     | 光标右移一个字符       |
| backspace | 光标左移一个字符       |
| N+        | 光标上移N行            |
| n+        | 光标下意n行            |



### Insert Mode

如果用户要对文件做修改，则可以使用下面几种命令，进入输入模式，用户进入输入模式之后，可以任意修改文件，除了 Esc 键外，用户输入的任何字符都会被作为内容写入文件中，用户输入 Esc 可以对文件进行相关操作。

| Value                  | Description  |
| ---------------------- | ------------ |
| a、i、r、o、A、I、R、O | 编辑模式     |
| dd                     | 删除当前光标 |
| ndd                    | 删除n行      |



### Bottom-Line Mode

如果用户完成编辑命令，则可以按照 esc + “:” 进入末行模式，用户可以对文件内容继续进行搜索，也可以输入 “:wq!” 进行文件保存并退出，或者输入 “:q!” 强制退出文件编辑。

| Value         | Description                  |
| ------------- | ---------------------------- |
| :wq!          | 保存并退出                   |
| :q!           | 强制退出                     |
| :s/str1 /str2 | 将文件中出现的str1替换为str2 |
| :set nu       | 显示所有行号                 |



## VIM Command

默认情况下，打开 vi 编辑器后自动进入命令模式。从编辑模式切换到命令模式使用“esc”键，从命令模式切换到编辑模式使用“A”、“a”、“O”、“o”、“I”、“i”键。

vi 编辑器提供了丰富的内置命令，有些内置命令使用键盘组合键即可完成，有些内置命令则需要以冒号“：”开头输入。常用内置命令如下：



```
1 Ctrl+u：向文件首翻半屏；
2 Ctrl+d：向文件尾翻半屏；
3 Ctrl+f：向文件尾翻一屏；
4 Ctrl+b：向文件首翻一屏；
5 Esc：从编辑模式切换到命令模式；
6 ZZ：命令模式下保存当前文件所做的修改后退出 vi；
7 :行号：光标跳转到指定行的行首；
8 :$：光标跳转到最后一行的行首；
9 x 或 X：删除一个字符，x 删除光标后的，而 X 删除光标前的；
10 D：删除从当前光标到光标所在行尾的全部字符；
11 dd：删除光标行正行内容；
12 ndd：删除当前行及其后 n-1 行；
13 nyy：将当前行及其下 n 行的内容保存到寄存器?中，其中？为一个字母，n 为一个数字；
14 p：粘贴文本操作，用于将缓存区的内容粘贴到当前光标所在位置的下方；
15 P：粘贴文本操作，用于将缓存区的内容粘贴到当前光标所在位置的上方；
16 /字符串：文本查找操作，用于从当前光标所在位置开始向文件尾部查找指定字符串的内容，查找的字符串会被加亮显示；
17 ？name：文本查找操作，用于从当前光标所在位置开始向文件头部查找指定字符串的内容，查找的字符串会被加亮显示；
18 a，bs/F/T：替换文本操作，用于在第 a 行到第 b 行之间，将 F 字符串换成 T 字符串。其中，“s/”表示进行替换操作；
19 a：在当前字符后添加文本；
20 A：在行末添加文本；
21 i：在当前字符前插入文本；
22 I：在行首插入文本；
23 o：在当前行后面插入一空行；
24 O：在当前行前面插入一空行；
25 :wq：在命令模式下，执行存盘退出操作；
26 :w：在命令模式下，执行存盘操作；
27 :w！：在命令模式下，执行强制存盘操作；
28 :q：在命令模式下，执行退出 vi 操作；
29 :q！：在命令模式下，执行强制退出 vi 操作；
30 :e 文件名：在命令模式下，打开并编辑指定名称的文件；
31 :n：在命令模式下，如果同时打开多个文件，则继续编辑下一个文件；
32 :f：在命令模式下，用于显示当前的文件名、光标所在行的行号以及显示比例；
33 :set nu：在命令模式下，用于在最左端显示行号；
34 :set nonu：在命令模式下，用于在最左端不显示行号；
35 :1,3y 复制第一行到第三行
36 :1,3d 删除第一行到第三行
37 :1,3s/str/str_new/g 替换第一行到第三行中的字符串
38 :1,3s/str/str_new 替换第一行到第三行中的字符串第一个字符
39 :1,3 g/str /d 删除第一行到第三行中含有这个字符串的行
```



```
#normal模式下 g表示全局, x表示查找的内容, y表示替换后的内容
:%s/x/y/g

#normal模式下
0  # 光标移到行首(数字0)
$  # 光标移至行尾
shift + g # 跳到文件最后
gg # 跳到文件头

# 显示行号
:set nu

# 去除行号
:set nonu

# 检索
/xxx(检索内容)  # 从头检索, 按n查找下一个
?xxx(检索内容)  # 从尾部检索
```



## Others

### vim编辑模式下的命令

i在当前光标出插入
o换下一行插入 O换上一行插入
2yy复制两行 p粘贴



### 非编辑模式下

shift+g快速定位到最后一行 shift+g+1或者gg快速定位到第一行
end行尾 home行首
：w保存q退出!强制 shift+zz保存退出
u撤销
/+关键字快速定位 n定位到下一个关键字
dd删除光标所在行 2dd删除两行
x删除文字后面的字 X删除光标前面的字
:set nu显示行号
:set nonu取消行号
/ 内容 (初始向下搜索，n向下搜，N向上搜)



### 替换

如果替换的内容中有/可以换成#或@(/ # @都是分隔符)

:%s#nologin#login#g(全局替换)-

21,24s#nologin#login#g(局部21,24替换)